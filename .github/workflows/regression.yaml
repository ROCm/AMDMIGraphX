on:
  push:
    branches: [develop]
env:
  TEST: false
  DOCKERBASE: rocm-migraphx:5.1
  MIOPENTUNE: miopen-rocm51

name: MIGraphX Regression test

jobs: 
  # check_image_version:
  #   name: Check Image Version
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: Check new image
  #       id: chk_img
  #       if: ${{ env.TEST == true }}
  #       run: exit 1
  build_image:
    name: Build New Image
    runs-on: self-hosted
    # needs: check_image_version
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Docker build
        run: |
          cd ./rocm-migraphx/dockerfiles
          docker build -t "rocm-migraphx:$(date +%Y%m%d)" --no-cache --build-arg BRANCH=$GITHUB_REF_NAME --build-arg DOCKERBASE=${{ env.DOCKERBASE }} --build-arg MIOPENTUNE=${{ env.MIOPENTUNE }} -f dockerfile-daily .